<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caro's Pizzeria</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <style>
    :root { --primary-red:#E31837; --dark-red:#C41230; --warm-brown:#8B4513; --cream:#FFF8E7; }
    *{margin:0;padding:0;box-sizing:border-box;font-family:Georgia,serif}
    body{line-height:1.6;background:var(--cream);overflow-x:hidden}
    .header{ text-align:center; padding:3rem 1rem; background:#fff; max-width:1200px; margin:0 auto; box-shadow:0 2px 4px rgba(0,0,0,.1); }
    .logo{ max-width:400px; margin:2rem auto; display:block; }
    .tagline{ font-style:italic; color:var(--warm-brown); font-size:1.1rem; margin-bottom:1rem; }
    .phone-option{ display:inline-flex; align-items:center; gap:.5rem; font-weight:bold; padding:.5rem 1rem; border-radius:5px; text-decoration:none; border:2px solid var(--primary-red); color:var(--primary-red); font-size:1.1rem; transition:all .3s }
    .phone-option:hover{ background:var(--primary-red); color:#fff }
    .phone-option.secondary{ border-color:#ddd; color:#999; font-size:.9rem; padding:.4rem .8rem }
    .phone-option.secondary:hover{ background:#666; color:#fff }
    .order-button{ display:inline-block; background:var(--primary-red); color:#fff; border:none; padding:1rem 2rem; border-radius:5px; font-size:1.2rem; font-weight:bold; cursor:pointer; transition:all .3s; box-shadow:0 4px 6px rgba(227,24,55,.3) }
    .order-button:hover{ background:var(--dark-red); transform:translateY(-2px); box-shadow:0 6px 12px rgba(227,24,55,.4) }
    .info-section{ max-width:800px; margin:2rem auto; padding:2rem; background:#fff; border-radius:5px; box-shadow:0 2px 4px rgba(0,0,0,.1) }
    .info-section h2{ color:var(--dark-red); margin-bottom:1rem; text-align:center }
    .menu-item{ margin:1rem 0; padding:1rem; background:var(--cream); border-radius:5px }
    .menu-item h3{ color:var(--warm-brown); margin-bottom:.5rem }
    .process-info{ font-style:italic; color:#666; text-align:center; margin:1rem 0 }
    footer{ text-align:center; padding:2rem; background:#333; color:#fff; margin-top:3rem }
    @media(max-width:600px){ .logo{ max-width:90%; margin:1rem auto } }
  </style>
</head>
<body>
  <header class="header">
    <img src="carospizzerialogo.png" alt="Caro's Pizza" class="logo" />
    <div class="tagline">Home of the original South Carolina-style pizza pie.</div>
    <div class="contact-options" style="display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;margin:1rem 0;">
      <a href="sms:5052264632?body=Hi!%20I'd%20like%20to%20order%20a%20pizza." class="phone-option secondary">ðŸ’¬ Text</a>
      <a href="tel:5052264632" class="phone-option secondary">ðŸ“ž Call</a>
    </div>
  </header>

  <!-- DROP (LIVE PURCHASE) -->
  <div class="info-section" id="drop">
    <h2>ðŸ”¥ Todayâ€™s Pizza Drop</h2>
    <p class="process-info">Pre-purchase now. Pickup <span id="pickupWindow">â€”</span>. Limited pies; when theyâ€™re gone, theyâ€™re gone.</p>

    <div id="dropStatus" style="text-align:center;margin:.5rem 0 1rem;">Checking availabilityâ€¦</div>

    <div class="menu-item" style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;">
      <!-- Rename labels here anytime -->
      <select id="topping" style="padding:.5rem;border:1px solid #ddd;border-radius:4px;">
        <option value="cheese">Grandma Gigi Style Plain</option>
        <option value="pepperoni">Pepperoni</option>
      </select>
      <select id="qty" style="padding:.5rem;border:1px solid #ddd;border-radius:4px;">
        <option>1</option><option>2</option><option>3</option><option>4</option>
      </select>

      <!-- Tip choices -->
      <div id="tips" style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;margin-left:auto;">
        <span style="color:#666;">Tip:</span>
        <label><input type="radio" name="tip" value="" checked> None</label>
        <label><input type="radio" name="tip" value="tip1">$1</label>
        <label><input type="radio" name="tip" value="tip2">$2</label>
        <label><input type="radio" name="tip" value="tip3">$3</label>
      </div>

      <button class="order-button" id="buyBtn" disabled>Loadingâ€¦</button>
    </div>
    <div style="font-size:.9rem;color:#666;margin-top:.5rem;">Pay with card, Apple Pay, or Google Pay.</div>
  </div>

  <!-- MENU / INFO -->
  <div class="info-section">
    <h2>Our Pies</h2>
    <p class="process-info">All from scratch and made to order with a dough that takes days to craft.</p>

    <div class="menu-item">
      <h3>Grandma Gigi Style Plain</h3>
      <p>Jersey tomatoes in the secret recipe sauce, mozzarella, an ode to the grandma-style pie but with a whole different spin.</p>
    </div>
    <div class="menu-item">
      <h3>Pepperoni</h3>
      <p>The Grandma Gigi with crispy pepperoni on top.</p>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 Caroâ€™s Pizzeria. Made with love.</p>
  </footer>

  <!-- DROP SCRIPT -->
  <script>
  // Paste your Apps Script Web App URL here:
  const GAS_URL = 'PASTE_YOUR_APPS_SCRIPT_WEB_APP_URL_HERE';
  let TIP_PRICE_IDS = { tip1:'', tip2:'', tip3:'' };

  async function loadDropStatus(){
    const S = document.getElementById('dropStatus');
    const B = document.getElementById('buyBtn');
    const W = document.getElementById('pickupWindow');

    try{
      const r = await fetch(GAS_URL+'?route=status');
      const d = await r.json();

      if (!d.ok || !d.active){
        S.textContent = 'No drop today.';
        B.disabled = true; B.textContent = 'UNAVAILABLE';
        W.textContent = 'â€”';
        return;
      }

      TIP_PRICE_IDS = { tip1: d.price_tip1||'', tip2: d.price_tip2||'', tip3: d.price_tip3||'' };

      W.textContent = d.pickup_window || 'today';
      if (d.soldOut){
        S.innerHTML = `Sold out for ${d.date_iso} (${d.pickup_window}).`;
        B.disabled = true; B.textContent = 'SOLD OUT';
        return;
      }

      S.innerHTML = `${d.remaining} left for ${d.date_iso} (${d.pickup_window}).`;

      const topSel = document.getElementById('topping');
      if (!d.variants?.pepperoni) [...topSel.options].forEach(o => o.value==='pepperoni' && (o.disabled=true));
      if (!d.variants?.cheese)    [...topSel.options].forEach(o => o.value==='cheese'    && (o.disabled=true));

      if (!TIP_PRICE_IDS.tip1) document.querySelector('input[name="tip"][value="tip1"]').parentElement.style.display='none';
      if (!TIP_PRICE_IDS.tip2) document.querySelector('input[name="tip"][value="tip2"]').parentElement.style.display='none';
      if (!TIP_PRICE_IDS.tip3) document.querySelector('input[name="tip"][value="tip3"]').parentElement.style.display='none';

      B.disabled = false; B.textContent = 'PRE-BUY NOW';
    } catch(e){
      S.textContent = 'Error loading drop.';
      B.disabled = true; B.textContent = 'ERROR';
    }
  }

  async function startCheckout(){
    const B = document.getElementById('buyBtn');
    const qty = Number(document.getElementById('qty').value);
    const topping = document.getElementById('topping').value;
    const tipKey = (document.querySelector('input[name="tip"]:checked') || {}).value || '';
    const tip_price_id = TIP_PRICE_IDS[tipKey] || '';

    B.disabled = true; B.textContent = 'Redirectingâ€¦';
    try{
      const r = await fetch(GAS_URL+'?route=create', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ quantity: qty, topping, tip_price_id })
      });
      const d = await r.json();
      if (d.ok && d.url){
        window.location = d.url;
      } else {
        alert('Sold out or not enough remaining.');
        await loadDropStatus();
        B.disabled = false; B.textContent = 'PRE-BUY NOW';
      }
    } catch(e){
      alert('Checkout error. Please refresh and try again.');
      B.disabled = false; B.textContent = 'PRE-BUY NOW';
    }
  }

  document.getElementById('buyBtn').addEventListener('click', startCheckout);
  loadDropStatus();
  </script>
</body>
</html>
